{% extends 'theme/base.html' %}

{% block heading %} Builder {% endblock heading %}
{% block body %}<div id="scene"></div>  {% endblock body %}
{% block js %}
<script async src="https://unpkg.com/es-module-shims@1.3.6/dist/es-module-shims.js"></script>

<script type="importmap">
  {
    "imports": {
      "three": "https://cdn.jsdelivr.net/npm/three/build/three.module.js"
    }
  }
</script>

<script type="module">

    import { Scene , PerspectiveCamera , WebGLRenderer } from 'three';
    import { OrbitControls } from 'https://cdn.jsdelivr.net/npm/three/examples/jsm/controls/OrbitControls.js';
    import { OBJLoader } from 'https://cdn.jsdelivr.net/npm/three/examples/jsm/loaders/OBJLoader.js';
    const renderer = new WebGLRenderer();
    renderer.setSize(400,400)
    document.getElementById('scene').append(renderer.domElement);
    const camera = new PerspectiveCamera( 45, 400 / 400, 1, 1000 );
    const scene = new Scene();
    scene.add( camera );
    
    const controls = new OrbitControls( camera, renderer.domElement );
    
    // instantiate a loader
    const loader = new OBJLoader();
    
    
    function loadJar(loader){
        // load a resource
        loader.load(
            // resource URL
            '{{jar_url}}',
            // called when resource is loaded
            function ( object ) {
                
                scene.add( object );
                
            },
            // called when loading is in progresses
            function ( xhr ) {
        
                console.log( ( xhr.loaded / xhr.total * 100 ) + '% loaded' );
        
            },
            // called when loading has errors
            function ( error ) {
                
                console.log( 'An error happened' );
                
            }
        );
    }
    function animate() {
        requestAnimationFrame(animate)
        console.log(scene.toJSON())
        render()
    }
    
    function render() {
        renderer.render(scene, camera)
    }
    
    loadJar(loader);
    animate()
    
</script>
{% endblock js %}